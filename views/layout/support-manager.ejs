<%- breadcrumb %>
<script>
</script>
<div class="card">
    <div class="lv-header-alt clearfix m-b-5">
        <h2 class="lvh-label hidden-xs">Danh sách các yêu cầu</h2>
        <ul class="lv-actions actions">
            <li><a href="javascript:void(0)" data-toggle="tooltip" data-placement="top" data-original-title="Làm mới danh sách"><i class="zmdi zmdi-refresh"></i></a></li>
        </ul>
    </div>
    <div class="card-body">
        <div class="table-responsive" style="min-height: 500px">
            <table class="table table-bordered table-fix" id="table-categorys">
                <thead>
                <tr>
                    <th class="bgm-orange c-white text-center w-30">TT</th>
                    <th class="w-120 bgm-orange c-white text-center">Tên dự án</th>
                    <th class="w-90 bgm-orange c-white text-center">Loại sự cố</th>
                    <th class="w-120 bgm-orange c-white text-center">Tiêu đề</th>
                    <th class="w-90 bgm-orange c-white text-center">Thời gian gửi</th>
                    <th class="w-90 bgm-orange c-white text-center">Mức độ ưu tiên</th>
                    <th class="w-120 bgm-orange c-white text-center">Người gửi</th>
                    <th class="w-120 bgm-orange c-white text-center">Người nhận</th>
                    <th class="w-90 bgm-orange c-white text-center">Trạng thái</th>
                    <th class="w-120 bgm-orange c-white text-center">Tác vụ</th>
                </tr>
                </thead>
                <tbody>
                <tr id="searchForm" class="filter">
                    <td class="text-center">
                    </td>
                    <td class="text-center"><input class="form-control filter" type="text" placeholder="Tên dự án" id="name" name="name"></td>
                    <td class="text-center">
                        <select class="selectpicker" id="type" name="type">
                        </select>
                    </td>
                    <td class="text-center"><input class="form-control filter" type="text" placeholder="Tiều đề" id="title" name="title"></td>
                    <td class="text-center">
                    </td>
                    <td class="text-center">
                        <select class="selectpicker" id="prior" name="prior">
                            <option value="">
                                -------
                            </option>
                            <option value="1">
                                Mức 1
                            </option>
                            <option value="2">
                                Mức 2
                            </option>
                            <option value="3">
                                Mức 3
                            </option>
                            <option value="4">
                                Mức 4
                            </option>
                            <option value="5">
                                Khẩn cấp
                            </option>
                        </select>
                    </td>
                    <td></td>
                    <td></td>
                    <td class="text-center">
                        <select class="selectpicker" id="status" name="status">
                            <option value=""><span class="">-------</span></option>
                            <option value="1"><span class="">Đã nhận</span></option>
                            <option value="2"><span class="">Đã xử lý</span></option>
                        </select>
                    </td>
                    <td><button class="btn btn-primary btn-block waves-effect" id="btn-search" name="btn-search"><i class="zmdi zmdi-filter-list m-r-5"></i> Lọc</button></td>
                </tr>
                    <% reports.forEach(function(el, i) { 
                        let status= ""
                        if(el.hasOwnProperty("status")){
                            status = el.status
                        }
                    %>
                    <tr id="item" class="stt<%=status%>">
                        <td class="select-cell text-center"><%- i+1 %></td>
                        <td>
                            <a href="/#support-manager/<%- el._id %>"><%- el.name %></a>
                        </td>
                        <input type="hidden" value="<%- el._id %>" name="id">
                        <td class="text-center text-capitalize"><%- el.type %></td>
                        <td class="text-center"><%- el.title %></td>
                        <td class="text-center"><%- moment(el.createdAt).format("HH:mm - Do MMM YYYY ") %></td>
                        <td class="text-center">
                            <%if(el.prior == 1){%>
                                Mức 1
                            <%}else if(el.prior == 2){%>
                                Mức 2
                            <%}else if(el.prior == 3){%>
                                Mức 3
                            <%}else if(el.prior == 4){%>
                                Mức 4
                            <%}else{%>
                                Khẩn cấp
                            <%}%>
                        </td>
                       
                        <td class="text-center"><%- el.fieldName[0].name%></td>
                        <td class="text-center">
                            <%if(el.hasOwnProperty("supporter")){%>
                                <%- el.supporter.name%>
                            <%}%>
                        </td>
                        <td>
                            <%if(el.status ==0){%>
                                <span class="" style="font-weight : bold; font-size : 1.1rem;">Chưa xử lý</span>
                            <%}else if(el.status == 1){%>
                                <span class="text-success" style="font-weight : bold; font-size : 1.1rem;">Đã được nhận</span>
                            <%}else if(el.status ==2){%>
                                <span class="text-danger" style="font-weight : bold; font-size : 1.1rem;">Đã xử lý</span>
                            <%}%>
                        </td>
                        <td class="text-center" >
                            
                            <%if(el.status == 0){%>
                                <a class="btn btn-primary btn-inline waves-effect btn-received" data-id="<%- el._id %>" data-status="<%- el.status %>" data-name="<%- el.name %>" data-toggle="tooltip" data-placement="top"  name="btn-received">
                                 Nhận
                                </a>
                            <% }%>
                            <a class="btn btn-primary btn-inline waves-effect btn-response" href="/#support-manager/new?_id=<%- el._id %>" data-id="<%- el._id %>" data-status="<%- el.status %>" data-name="<%- el.name %>" data-toggle="tooltip" data-placement="top" name="btn-response"> Phản hồi</a>
                            <%if(el.status == 2){ %>
                                <a role="button" class="btn-remove btn-flat-bg" data-toggle="tooltip" data-placement="top" data-original-title="Xoá" data-id="<%- el._id %>"><i class="zmdi zmdi-close red f-23 "></i></a>                                
                            <% }%>
                        </td>
                    </tr>
                    
                    <% }); %>
                    
                </tbody>
            </table>
            <% if (reports.length == 0){ %>
                <div id="empty-container" class="border">
                    <div class="text-center" id="empty-text">Không có yêu cầu mới</div>
                </div>
            <%}%>
        </div>

        <% include ../paging.ejs %>
    </div>
</div>
